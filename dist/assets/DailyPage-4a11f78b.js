import{r as S,E as U,v as R,t as q,B as T,j as e,D as s,Q as j,I as N}from"./index.esm-09f2711e.js";import{u as W,s as Y,P as G,F as m,I as h,a as p,b as g,e as Q}from"./zod.module-1bddeb2b.js";import{u as z,s as K,l as J,a as D,d as A,B as X,A as Z,K as ee,Q as te}from"./firebase-ccb7ec06.js";import{C as b}from"./constants-4856e09f.js";import{u as ie}from"./store-51b217b0.js";import{A as ae}from"./index.esm-fcf5aec4.js";import{G as re}from"./index.esm-01c93377.js";import{T as se}from"./index.esm-5f03277d.js";import{a as le}from"./index.esm-ac24b545.js";import{m as H}from"./motion-6436106a.js";import{f as oe}from"./index-0872f226.js";import{B as u,F as ne,c as ce,a as de,C as ue,b as me}from"./index.esm-471b626d.js";import{a as B}from"./index.esm-58215cd6.js";import"./index-75959897.js";import"./index.esm-2da43d16.js";import"./index.esm-d752f8ac.js";import"./iconBase-7b4876a9.js";import"./index-9ba3ed2e.js";import"./index-b31f775c.js";function he(){const[y,o]=S.exports.useState(!1),[E,l]=S.exports.useState(null),n=z(),k=U(),i=ie();async function P({date:r,startingMiles:v,endingMiles:f,totalMiles:t,payMiles:M,backhaul:c}){if(o(!0),!(i!=null&&i.userId))return n({title:"You must be logged in to add pay",status:"error",isClosable:!0,position:"top",duration:5e3,colorScheme:"teal",variant:"solid"}),!1;const x=K(D(A,b.USERS,`${i==null?void 0:i.userId}`,b.PAYSHEETS),J("date","==",r)),w=await X(x);if(w.size>0){const d=w.docs[0].id,F=Z(A,b.USERS,`${i==null?void 0:i.userId}`,b.PAYSHEETS,d);try{await ee(F,{date:r,uid:i==null?void 0:i.userId,startingMiles:v,endingMiles:f,totalMiles:t,payMiles:M,backhaul:c}),n({title:"Pay updated",status:"success",isClosable:!0,position:"top",duration:5e3,colorScheme:"teal",variant:"solid"}),k(R.DASHBOARD)}catch(I){n({title:"Updating pay failed",description:I.message,status:"error",isClosable:!0,position:"top",duration:5e3,colorScheme:"pink.500",variant:"solid"}),l(I)}return!0}else try{await te(D(A,b.USERS,`${i==null?void 0:i.userId}`,b.PAYSHEETS),{date:r,uid:i==null?void 0:i.userId,startingMiles:v,endingMiles:f,totalMiles:t,payMiles:M,backhaul:c}),n({title:"Pay added",status:"success",isClosable:!0,position:"top",duration:5e3,colorScheme:"teal",variant:"solid"}),k(R.DASHBOARD)}catch(d){n({title:"Adding pay failed",description:d.message,status:"error",isClosable:!0,position:"top",duration:5e3,colorScheme:"pink.500",variant:"solid"}),l(d)}finally{o(!1)}}return{addPay:P,isPayLoading:y,payError:E}}const pe=()=>{const y=q(),o=y==null?void 0:y.state,E=T("white"," gray.800"),l=T("gray.400","gray.500"),n=le(new Date().toISOString().slice(0,10)),i=(a=>a?{date:oe(a.date,"yyyy-MM-dd"),startingMiles:`${a.startingMiles}`,endingMiles:`${a.endingMiles}`,totalMiles:a.totalMiles,payMiles:`${a.payMiles}`,backhaul:`${a.backhaul}`}:{date:n})(o),{addPay:P}=he(),{register:r,handleSubmit:v,watch:f,formState:{errors:t,isDirty:M,isSubmitting:c,isValid:x},control:w,reset:d,getValues:F,setValue:I,setFocus:L}=W({defaultValues:i,resolver:Y(G)}),_=a=>{try{P({...a}),d()}catch(C){console.log(C)}},$=()=>{const a=Number(F("startingMiles")),C=Number(F("endingMiles")),O=C-a>0?C-a:0;I("totalMiles",O)};S.exports.useEffect(()=>{$()},[f("startingMiles"),f("endingMiles")]),S.exports.useEffect(()=>{L("startingMiles")},[]);const V=S.exports.useCallback(function(){return o?!0:M&&x&&!c&&!Object.keys(t).length},[M,x,c,t,o])();return e(H.div,{initial:{opacity:0,y:80,scale:.8},animate:{opacity:1,y:0,scale:[.9,1.2,1]},transition:{type:"spring",stiffness:90,damping:15},exit:{opacity:0},children:e(u,{border:"2px",borderColor:"cyan.600",boxShadow:"dark-lg",p:"4",rounded:"md",mt:10,mb:10,w:"60vw",maxW:"500px",minW:"350px",bg:E,children:e(u,{p:"4",children:s(j,{onSubmit:v(_),children:[s(m,{isInvalid:!!t.date,isRequired:!0,variant:"floating",children:[e(h,{...r("date"),id:"date",type:"date",placeholder:"date",mb:"3",mt:"3",_placeholder:{color:l}}),e(p,{htmlFor:"date",children:"Date"}),e(g,{children:t.date&&t.date.message})]}),e(u,{my:"3",children:s(m,{isInvalid:!!t.startingMiles,isRequired:!0,variant:"floating",children:[e(h,{...r("startingMiles"),id:"startingMiles",type:"number",placeholder:"Starting Miles",mb:"3",_placeholder:{color:l}}),e(p,{htmlFor:"startingMiles",children:"Starting Miles:"}),e(g,{children:t.startingMiles&&t.startingMiles.message})]})}),e(u,{my:"3",children:s(m,{isInvalid:!!t.endingMiles,isRequired:!0,variant:"floating",children:[e(h,{...r("endingMiles"),id:"endingMiles",type:"number",placeholder:"Ending Miles",mb:"3",_placeholder:{color:l}}),e(p,{htmlFor:"endingMiles",children:"Ending Miles:"}),e(g,{children:t.endingMiles&&t.endingMiles.message})]})}),e(u,{my:"3",children:s(m,{isInvalid:!!t.totalMiles,isRequired:!0,variant:"floating",children:[e(h,{...r("totalMiles"),id:"totalMiles",type:"number",placeholder:"Total Miles",disabled:!0,mb:"3",_placeholder:{color:l}}),e(p,{htmlFor:"totalMiles",children:"Total Miles:"}),e(g,{children:t.totalMiles&&t.totalMiles.message}),s(Q,{ml:"10",children:[e(N,{as:se,w:3,h:3})," Total miles are automatically calculated"]})]})}),e(u,{my:"3",children:s(m,{isInvalid:!!t.payMiles,isRequired:!0,variant:"floating",children:[e(h,{...r("payMiles"),id:"payMiles",type:"number",placeholder:"Pay Miles",mb:"3",_placeholder:{color:l}}),e(p,{htmlFor:"payMiles",children:"Pay Miles:"}),e(g,{children:t.payMiles&&t.payMiles.message})]})}),e(u,{my:"3",children:s(m,{isInvalid:!!t.backhaul,isRequired:!0,variant:"floating",children:[e(h,{...r("backhaul"),id:"backhaul",placeholder:"BackHaul",mb:"3",_placeholder:{color:l}}),e(p,{htmlFor:"backhaul",children:"Backhaul:"}),e(g,{children:t.backhaul&&t.backhaul.message})]})}),s(ne,{children:[e(B,{mt:4,px:5,colorScheme:"cyan",isLoading:c,type:"submit",disabled:!V,loadingText:o?"Updating":"Submitting",variant:"outline",_hover:{bg:"cyan.600",color:"white",scale:1.1},rightIcon:e(ae,{}),children:"Submit"}),e(ce,{}),e(B,{mt:4,colorScheme:"red",onClick:()=>d(),disabled:c,variant:"outline",_hover:{bg:"red.600",color:"white",scale:1.1},rightIcon:e(re,{}),children:"Reset"})]})]})})})})},ge=pe;function He(){return q(),s(de,{maxW:"container.xl",centerContent:!0,bg:'"linear(to-b, #42047e, #07f49e)"',children:[e(ue,{children:e(me,{as:H.h1,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},mt:10,bgGradient:"linear(to-b, #42047e, #07f49e)",bgClip:"text",fontSize:["4xl","4xl","5xl"],fontWeight:"extrabold",children:"Daily Form"})}),e(ge,{})]})}export{He as default};
//# sourceMappingURL=DailyPage-4a11f78b.js.map
