import{r as d,E as G,v as I,B as H,D as i,j as e,Q as M,M as U}from"./index.esm-5bedf466.js";import{u as j,s as q,C as N,F as b,I as E,a as y,b as v}from"./zod.module-0c2f3d95.js";import{u as O,c as L,E as T,q as z,v as K,A as V,d as $,K as Q,r as Y}from"./firebase-1cff0f71.js";import{C as J,f as X}from"./constants-4856e09f.js";import{s as Z}from"./store-105db165.js";import{S as _}from"./isGoogleSlideIn-f329f755.js";import{m as P}from"./motion-91c60b2e.js";import{a as ee,C as A,b as ae,B as n,H as te,T as re}from"./index.esm-80b5a022.js";import{a as D}from"./index.esm-13c06ba6.js";import"./index-75959897.js";import"./index.esm-3d7316f0.js";import"./index.esm-2be1a8a4.js";import"./index.esm-d6abb1fb.js";import"./index.esm-36b4b751.js";function se(){const[m,c]=d.exports.useState(!1),[f,o]=d.exports.useState(null),t=O(),g=G();async function x({email:S,password:w,newEmail:l}){var u;const a=L.currentUser;if(c(!0),((u=a==null?void 0:a.providerData[0])==null?void 0:u.providerId)==="google.com"){o("Please enter your new password"),t({title:"Password reset failed",description:"Please enter your new password",status:"error",isClosable:!0,position:"top",duration:5e3,variant:"solid"});return}if(!w){o("Password must be at least 6 characters"),t({title:"Password reset failed",description:"Password must be at least 6 characters",status:"error",isClosable:!0,position:"top",duration:5e3,variant:"solid"});return}if(!S){o("Email must be at least 6 characters"),t({title:"Password reset failed",description:"Email must be at least 6 characters",status:"error",isClosable:!0,position:"top",duration:5e3,variant:"solid"});return}if(a&&a.email){const p=T.credential(a.email,w);try{await z(a,p),await K(a,l),t({title:"Email updated",description:"Your email has been updated",status:"success",isClosable:!0,position:"top",duration:5e3,variant:"solid",colorScheme:"cyan"}),Z.setUserEmail(l);const s=V($,J.USERS,`${a.uid}`);await Q(s,{email:l,updatedAt:Y()}),g(I.DASHBOARD,{replace:!0})}catch(s){const C=X.get(`${s.code.toString()}`);t({title:"Email change failed",description:C||s.message,status:"error",isClosable:!0,position:"top",duration:5e3,variant:"solid"}),o(s)}finally{c(!1)}}}return{changeEmail:x,isLoading:m,error:f}}function Ee(){const[m,c]=d.exports.useState(!1),{changeEmail:f,error:o}=se(),{register:t,handleSubmit:g,watch:x,setError:S,clearErrors:w,setFocus:l,formState:{errors:a,isDirty:u,isSubmitting:p,isValid:s,touchedFields:C}}=j({resolver:q(N)}),R=async r=>{try{console.log(r),await f({email:r.email,password:r.password,newEmail:r.newEmail})}catch(h){console.log(h)}};d.exports.useEffect(()=>{l("password")},[]);const B=H("white"," gray.800"),W=()=>{var h,F;const r=(h=L)==null?void 0:h.currentUser;return r!==null&&((F=r==null?void 0:r.providerData[0])==null?void 0:F.providerId)==="google.com"},k=u&&s&&!p&&!m;return d.exports.useEffect(()=>{c(W())},[]),i(ee,{maxW:{base:"100%",sm:"95%"},mt:8,children:[e(A,{children:e(ae,{mt:"10",as:P.h1,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},bgGradient:"linear(to-b, #42047e, #07f49e)",bgClip:"text",fontSize:["3xl","3xl","4xl"],fontWeight:"extrabold",children:"Update Email"})}),e(P.div,{initial:{opacity:0,y:80,scale:.8},animate:{opacity:1,y:0,scale:[.9,1.2,1]},transition:{type:"spring",stiffness:90,damping:15},exit:{opacity:0},children:e(n,{bg:B,border:"2px",borderColor:"gray.700",boxShadow:"dark-lg",p:"5",rounded:"md",mt:10,mb:10,w:"50vw",maxW:"500px",minW:"350px",mx:"auto",children:e(n,{p:"3",children:i(M,{onSubmit:g(R),children:[e(n,{my:2,children:i(b,{isInvalid:!!a.password,isRequired:!0,variant:"floating",children:[e(E,{...t("email"),id:"email",type:"email",placeholder:"Email",autoComplete:"email",mb:"4"}),e(y,{htmlFor:"email",children:"Current Email"}),e(v,{children:a.email&&a.email.message})]})}),e(n,{my:2,children:i(b,{isInvalid:!!a.password,isRequired:!0,variant:"floating",children:[e(E,{...t("password"),id:"password",type:"password",placeholder:"Password ",autoComplete:"new-password",mb:"4"}),e(y,{htmlFor:"password",children:"Password"}),e(v,{children:a.password&&a.password.message})]})}),e(n,{my:2,children:i(b,{isInvalid:!!a.newEmail,isRequired:!0,variant:"floating",children:[e(E,{...t("newEmail"),id:"newEmail",type:"email",placeholder:"New Email",autoComplete:"email"}),e(y,{htmlFor:"newEmail",children:"New Email"}),e(v,{children:a.newEmail&&a.newEmail.message})]})}),e(A,{my:2,children:e(D,{my:4,w:"full",colorScheme:"cyan",isLoading:p,type:"submit",size:"lg",disabled:!k,variant:"outline",children:"Submit"})}),i(te,{spacing:"1",justify:"center",children:[e(re,{color:"muted",children:"Go back to"}),e(D,{as:U,to:I.DASHBOARD,variant:"link",colorScheme:"cyan",children:"Dashboard"})]})]})})})}),e(_,{isGoogle:m})]})}export{Ee as default};
//# sourceMappingURL=ChangeEmailPage-4e4c0fcb.js.map
