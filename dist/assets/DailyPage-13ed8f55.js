import{r as S,d as N,f as U,j as e,p as r}from"./index-ad61e450.js";import{u as W,i as Y,s as z,j as K,k as Q,l as D,m as c,d as R,B as _,A as G,K as J,n as A,Q as X,p as Z,q as ee,v as te,w as L,x as d,F as ie,y as u,I as m,z as h,D as g,E as ae,H as q,S as se,J as re,L as le,M as ne,N as oe,R as de}from"./routes-3ee497c9.js";import{f as ce}from"./index-18bfe9e5.js";import"./index-344f66e9.js";function ue(){const[p,l]=S.exports.useState(!1),[I,k]=S.exports.useState(null),n=W(),v=N(),i=Y(z);async function w({date:s,startingMiles:x,endingMiles:y,totalMiles:t,payMiles:b,backhaul:o}){if(l(!0),!(i!=null&&i.userId))return n({title:"You must be logged in to add pay",status:"error",isClosable:!0,position:"top",duration:5e3,colorScheme:"teal",variant:"solid"}),!1;const F=K(D(R,c.USERS,`${i==null?void 0:i.userId}`,c.PAYSHEETS),Q("date","==",s)),P=await _(F);if(P.size>0){const M=P.docs[0].id,E=G(R,c.USERS,`${i==null?void 0:i.userId}`,c.PAYSHEETS,M);try{await J(E,{date:s,uid:i==null?void 0:i.userId,startingMiles:x,endingMiles:y,totalMiles:t,payMiles:b,backhaul:o}),n({title:"Pay updated",status:"success",isClosable:!0,position:"top",duration:5e3,colorScheme:"teal",variant:"solid"}),v(A.DASHBOARD)}catch(f){n({title:"Updating pay failed",description:f.message,status:"error",isClosable:!0,position:"top",duration:5e3,colorScheme:"pink.500",variant:"solid"}),k(f)}return!0}else try{await X(D(R,c.USERS,`${i==null?void 0:i.userId}`,c.PAYSHEETS),{date:s,uid:i==null?void 0:i.userId,startingMiles:x,endingMiles:y,totalMiles:t,payMiles:b,backhaul:o}),n({title:"Pay added",status:"success",isClosable:!0,position:"top",duration:5e3,colorScheme:"teal",variant:"solid"}),v(A.DASHBOARD)}catch(M){n({title:"Adding pay failed",description:M.message,status:"error",isClosable:!0,position:"top",duration:5e3,colorScheme:"pink.500",variant:"solid"}),k(M)}finally{l(!1)}}return{addPay:w,isPayLoading:p,payError:I}}const me=()=>{const p=U(),l=p==null?void 0:p.state,I=Z(new Date().toISOString().slice(0,10)),n=(a=>a?{date:ce(a.date,"yyyy-MM-dd"),startingMiles:`${a.startingMiles}`,endingMiles:`${a.endingMiles}`,totalMiles:a.totalMiles,payMiles:`${a.payMiles}`,backhaul:`${a.backhaul}`}:{date:I})(l),{addPay:v,isPayLoading:i,payError:w}=ue(),{register:s,handleSubmit:x,watch:y,formState:{errors:t,isDirty:b,isSubmitting:o,isValid:F,touchedFields:P},control:M,reset:E,getValues:f,setValue:T,setFocus:B}=ee({defaultValues:n,resolver:re(le)}),H=a=>{try{v({...a}),E()}catch(C){console.log(C)}},$=()=>{const a=Number(f("startingMiles")),C=Number(f("endingMiles")),j=C-a>0?C-a:0;T("totalMiles",j)};S.exports.useEffect(()=>{$()},[y("startingMiles"),y("endingMiles")]),S.exports.useEffect(()=>{B("startingMiles")},[]);const V=te("white"," gray.800"),O=S.exports.useCallback(function(){return l?!0:b&&F&&!o&&!Object.keys(t).length},[b,F,o,t,l])();return e(L.div,{initial:{opacity:0,y:80,scale:.8},animate:{opacity:1,y:0,scale:[.9,1.2,1]},transition:{type:"spring",stiffness:90,damping:15},exit:{opacity:0},children:e(d,{bg:V,border:"2px",borderColor:"cyan.700",boxShadow:"dark-lg",p:"4",rounded:"md",mt:10,mb:10,w:"60vw",maxW:"500px",minW:"300px",children:e(d,{p:"4",children:r(ie,{onSubmit:x(H),children:[r(u,{isInvalid:!!t.date,isRequired:!0,variant:"floating",children:[e(m,{...s("date"),id:"date",type:"date",placeholder:"date",mb:"3",mt:"3"}),e(h,{htmlFor:"date",children:"Date"}),e(g,{children:t.date&&t.date.message})]}),e(d,{my:"3",children:r(u,{isInvalid:!!t.startingMiles,isRequired:!0,variant:"floating",children:[e(m,{...s("startingMiles"),id:"startingMiles",type:"number",placeholder:"Starting Miles",mb:"3"}),e(h,{htmlFor:"startingMiles",children:"Starting Miles:"}),e(g,{children:t.startingMiles&&t.startingMiles.message})]})}),e(d,{my:"3",children:r(u,{isInvalid:!!t.endingMiles,isRequired:!0,variant:"floating",children:[e(m,{...s("endingMiles"),id:"endingMiles",type:"number",placeholder:"Ending Miles",mb:"3"}),e(h,{htmlFor:"endingMiles",children:"Ending Miles:"}),e(g,{children:t.endingMiles&&t.endingMiles.message})]})}),e(d,{my:"3",children:r(u,{isInvalid:!!t.totalMiles,isRequired:!0,variant:"floating",children:[e(m,{...s("totalMiles"),id:"totalMiles",type:"number",placeholder:"Total Miles",disabled:!0,mb:"3"}),e(h,{htmlFor:"totalMiles",children:"Total Miles:"}),e(g,{children:t.totalMiles&&t.totalMiles.message})]})}),e(d,{my:"3",children:r(u,{isInvalid:!!t.payMiles,isRequired:!0,variant:"floating",children:[e(m,{...s("payMiles"),id:"payMiles",type:"number",placeholder:"Pay Miles",mb:"3"}),e(h,{htmlFor:"payMiles",children:"Pay Miles:"}),e(g,{children:t.payMiles&&t.payMiles.message})]})}),e(d,{my:"3",children:r(u,{isInvalid:!!t.backhaul,isRequired:!0,variant:"floating",children:[e(m,{...s("backhaul"),id:"backhaul",placeholder:"BackHaul",mb:"3"}),e(h,{htmlFor:"backhaul",children:"Backhaul:"}),e(g,{children:t.backhaul&&t.backhaul.message})]})}),r(ae,{children:[e(q,{mt:4,px:10,colorScheme:"cyan",isLoading:o,type:"submit",disabled:!O,loadingText:l?"Updating":"Submitting",variant:"outline",_hover:{bg:"cyan.600",color:"white",scale:1.1},children:"Submit"}),e(se,{}),e(q,{mt:4,colorScheme:"red",onClick:()=>E(),disabled:o,variant:"outline",_hover:{bg:"red.600",color:"white",scale:1.1},children:"Reset"})]})]})})})})},he=me;function fe(){return e("section",{children:r(ne,{maxW:"container.xl",centerContent:!0,children:[e(oe,{children:e(de,{as:L.h1,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},mt:10,bgGradient:"linear(to-b, #42047e, #07f49e)",bgClip:"text",fontSize:["4xl","4xl","5xl"],fontWeight:"extrabold",children:"Daily Form"})}),e(he,{})]})})}export{fe as default};
